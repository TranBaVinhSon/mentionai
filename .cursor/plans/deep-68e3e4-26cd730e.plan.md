<!-- 26cd730e-2bfe-4978-9e74-3f52f2749d53 b9962f07-341d-416b-bb73-16a219059174 -->
# Multi-Round Deep Think Tooling

1. Audit current Deep Think flow in `gengar/src/modules/completions/completions.service.ts` to confirm why `streamText` resolves after the first tool call and document the existing `deepThinkConfig` limits.
2. Introduce a dedicated helper (e.g. `runDeepThinkAgent` under `gengar/src/modules/completions/agents/deep-think-agent.ts`) that orchestrates iterative `streamText` calls, persisting accumulated context, tool results, and deciding when to keep looping vs synthesize.
3. Extend the Deep Think tool registration so `personaMemorySearch`, `webSearch`, and `retrieveContentFromUrl` can be invoked multiple times per session, capturing per-iteration metadata and emitting `deep-think-progress` SSE events after each loop.
4. Update the Deep Think system prompt (`gengar/src/modules/completions/prompts/get-deep-think-system-prompt.ts`) and planning instructions so the assistant explicitly plans multi-step research, optionally exposing a lightweight planner tool for query generation to encourage multiple tool invocations before final synthesis.
5. Adjust post-run synthesis and fallback handling in `completions.service.ts` so the conversation stores every iterationâ€™s references, and recap/usage tracking reflects the new multi-loop agent behavior.

### To-dos

- [ ] Review current Deep Think streaming and tool invocation limits in `completions.service.ts`.
- [ ] Add iterative Deep Think agent helper that loops tool calls until completion criteria is met.
- [ ] Revise Deep Think system prompt and optional planner tool semantics to encourage multi-step research.
- [ ] Ensure SSE progress + reference chunks emit for each agent loop and conversation persistence stores the new metadata.